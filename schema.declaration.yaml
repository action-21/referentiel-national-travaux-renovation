$schema: https://json-schema.org/draft/2020-12/schema
title: Déclaration de travaux de rénovation
type: object
properties:
  id:
    title: Identifiant du geste de travaux
    type: string
    format: uuid
  poste:
    title: Poste de travaux
    type: string
    enum:
      - ChauffageEcs
      - IsolationComblesToitures
      - IsolationMurs
      - IsolationPlanchersBas
      - MenuiseriesExterieures
      - Ventilation
      - Refroidissement
      - Regulation
      - Reseau
      - ProtectionsSolaires
  geste:
    title: Geste de travaux
    type: string
    description: Nomenclature des gestes de travaux à définir
  statut:
    title: Statut
    type: string
    enum:
      - GesteEngage
      - GesteRealise
  date_engagement:
    title: Date d'engagement des travaux
    type: string
    format: date
  date_realisation:
    title: Date de réalisation des travaux
    type: [string, "null"]
    format: date
  adresse:
    title: Adresse du geste
    description: https://github.com/BaseAdresseNationale/adresse.data.gouv.fr/blob/master/public/schemas/adresses-csv.md
    type: object
    properties:
      id:
        title: Identifiant de l'adresse dans la BAN
        type: string
      numero:
        title: Numéro de l'adresse dans la voie
        type: string
      rep:
        title: Indice de répétition associé au numéro (par exemple bis, a…)
        type: string
      nom_voie:
        title: Nom de la voie en minuscules accentuées
        type: string
      code_insee:
        title: Code INSEE de la commune actuelle sur la base du Code Officiel géographique en vigueur
        type: string
      code_postal:
        title: Code postal du bureau de distribution de la voie
        type: string
      nom_commune:
        title: Nom officiel de la commune actuelle
        type: string
    required:
      - id
      - nom_voie
      - code_insee
      - code_postal
      - nom_commune
  batiment:
    title: Bâtiment
    description: https://rnb-fr.gitbook.io/documentation/api-et-outils/export-national-et-departemental
    type: object
    properties:
      id:
        title: Identifiant du bâtiment dans la RNB
        type: string
      is_active:
        title: Défini si le bâtiment est considéré comme un bâtiment réel (quel que soit sont statut).
        type: boolean
    required:
      - id
      - is_active
  entreprises:
    title: Entreprises de travaux
    type: array
    items:
      type: object
      properties:
        denomination:
          title: Dénomination de l'entreprise
          type: string
        siret:
          title: SIRET de l'entreprise
          type: string
      required:
        - denomination
        - siret
required:
  - id
  - poste
  - geste
  - statut
  - date_engagement
  - date_realisation
  - adresse
  - batiment
  - entreprises
allOf:
  - oneOf:
      - title: Geste engagé
        type: object
        propertie:
          statut:
            const: GesteEngage
          date_realisation:
            const: null
        required:
          - statut
          - date_realisation
      - title: Geste réalisé
        type: object
        propertie:
          statut:
            const: GesteRealise
          date_realisation:
            type: string
        required:
          - statut
          - date_realisation
